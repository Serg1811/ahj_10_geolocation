{"version":3,"file":"main.js","mappings":"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","sources":["webpack://ahj_10_geolocation/./src/js/app.js","webpack://ahj_10_geolocation/./src/js/Timeline.js"],"sourcesContent":["import Timeline from './Timeline';\n\nconst app = new Timeline();\n\napp.init();\n","/* eslint-disable no-return-assign */\n\nexport default class Timeline {\n  init() {\n    this.renderTimeline();\n  }\n\n  renderTimeline() {\n    this.timeline = document.createElement('div');\n    this.timeline.classList.add('timeline');\n    this.container = document.createElement('div');\n    this.container.classList.add('container');\n    this.timeline.appendChild(this.container);\n    this.messageForm = document.createElement('form');\n    this.messageForm.classList.add('message-form');\n    this.messageForm.innerHTML = '<input id = \\'message-input\\' placeholder = \\'–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∑–∞–ø–∏—à–∏—Ç–µ –≤–∏–¥–µ–æ –∏–ª–∏ –∞—É–¥–∏–æ\\'>';\n    this.messageForm.innerHTML += '<div class = \\'record-audio\\'> </div> <div class = \\'record-video\\'> </div>';\n    this.timeline.appendChild(this.messageForm);\n    this.askPosition = document.createElement('form');\n    this.askPosition.classList.add('ask-position');\n    // eslint-disable-next-line max-len\n    this.askPosition.innerHTML = '<div> –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ <br> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ä—É—á–Ω—É—é <br> –®–∏—Ä–æ—Ç–∞ –∏ –¥–æ–ª–≥–æ—Ç–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é </div> <input id = \\'ask-input\\'> <div class = \\'btn-group\\'> <button class = \\'btn cancel-btn\\'> –û—Ç–º–µ–Ω–∞ </button> <button class = \\'btn ok-btn\\'> OK </button></div>';\n    this.invalidMessage = document.createElement('div');\n    this.invalidMessage.classList.add('invalid-message');\n    this.invalidMessage.innerText = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ–≤–∞–ª–∏–¥–Ω—ã';\n    document.querySelector('body').appendChild(this.timeline);\n    this.noAudio = document.createElement('div');\n    this.noAudio.classList.add('no-audio');\n    this.noAudio.innerHTML = '<div class = \\'no-audio-text\\'> –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞, –∫—É–ø–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏–ª–∏ –¥–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–≤—É–∫–æ–∑–∞–ø–∏—Å–∏ </div> <button class = \\'btn cancel-btn\\'> OK </button>';\n    this.noAudio.querySelector('.btn').onclick = () => this.noAudio.style.display = 'none';\n    this.timeline.appendChild(this.noAudio);\n    this.messageForm.addEventListener('submit', (evt) => {\n      evt.preventDefault();\n      this.publishTextMessage();\n    });\n    this.messageForm.querySelector('.record-audio').addEventListener('click', () => {\n      this.createMedia(false);\n    });\n    this.messageForm.querySelector('.record-video').addEventListener('click', () => {\n      this.createMedia(true);\n    });\n  }\n\n  getPosition() {\n    navigator.geolocation.getCurrentPosition((position) => (\n      this.position = {\n        latitude: position.coords.latitude,\n        longtitude: position.coords.longitude,\n      }), () => this.position = null);\n  }\n\n  createTextMessage(text, latitude, longtitude) {\n    const message = document.createElement('div');\n    message.classList.add('message');\n    message.innerHTML = `<div class = 'message-header'> ${new Date().toLocaleDateString()}, ${new Date().toLocaleTimeString()} </div> <div class = 'message-text'> ${text} </div> <div class = 'position'> üìç ${latitude}, ${longtitude} </div>`;\n    this.container.appendChild(message);\n    document.querySelector('#message-input').value = '';\n  }\n\n  publishTextMessage() {\n    this.getPosition();\n    setTimeout(() => {\n      this.text = document.querySelector('#message-input').value;\n      if (!this.text) {\n        return;\n      }\n      if (this.position) {\n        this.createTextMessage(this.text, this.position.latitude, this.position.longtitude);\n      } else {\n        this.timeline.appendChild(this.askPosition);\n        this.getManualPosition();\n      }\n    }, 3000);\n  }\n\n  getManualPosition() {\n    this.askPosition.querySelector('#ask-input').addEventListener('input', () => {\n      if (document.querySelector('.invalid-message')) {\n        this.invalidMessage.remove();\n      }\n    });\n    this.askPosition.querySelector('.ok-btn').onclick = (evt) => {\n      evt.preventDefault();\n      const coords = this.askPosition.querySelector('#ask-input').value;\n      if (this.verifyCoords(coords)) {\n        this.askPosition.remove();\n        this.createTextMessage(this.text, this.position.latitude, this.position.longitude);\n      } else {\n        this.askPosition.appendChild(this.invalidMessage);\n      }\n    };\n    this.askPosition.querySelector('.cancel-btn').addEventListener('click', (evt) => {\n      evt.preventDefault();\n      this.askPosition.remove();\n    });\n  }\n\n  verifyCoords(coords) {\n    if (/^\\[([-+]?)([\\d]{1,2})(((\\.)(\\d+)(,)))(\\s*)(([-+]?)([\\d]{1,3})((\\.)(\\d+))?)\\]$/.test(coords)\n        || /^([-+]?)([\\d]{1,2})(((\\.)(\\d+)(,)))(\\s*)(([-+]?)([\\d]{1,3})((\\.)(\\d+))?)$/.test(coords)) {\n      let coordinates = coords.replace('[', '');\n      coordinates = coordinates.split(',');\n      // eslint-disable-next-line no-console\n      this.position = {\n        latitude: Number.parseFloat(coordinates[0]),\n        longitude: Number.parseFloat(coordinates[1]),\n      };\n\n      return true;\n    } return false;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  recorderTimer(element) {\n    let minutes = 0;\n    let seconds = 0;\n    setInterval(() => {\n      seconds += 1;\n      if (seconds === 60) {\n        minutes += 1;\n        seconds = 0;\n      }\n      if (seconds < 10) {\n        // eslint-disable-next-line no-param-reassign\n        element.innerText = `${minutes}:0${seconds}`;\n        return;\n      }\n      // eslint-disable-next-line no-param-reassign\n      element.innerText = `${minutes}:${seconds}`;\n    }, 1000);\n  }\n\n  async createMedia(videoBul) {\n    if (!navigator.mediaDevices) {\n      this.noAudio.style.display = 'block';\n    }\n    try {\n      this.stream = await navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: videoBul,\n      });\n    } catch (e) {\n      this.noAudio.style.display = 'block';\n      return;\n    }\n    this.getPosition();\n    this.audioRecorder = document.createElement('div');\n    this.audioRecorder.classList.add('audio-recorder');\n    this.audioRecorder.innerHTML = '<div class = \\'save-record\\'> </div> <div class = \\'record-timer\\'> 0:00 </div> <div class = \\'cancel-record\\'></div>';\n    const recorder = new MediaRecorder(this.stream);\n    this.chunks = [];\n    recorder.addEventListener('start', () => {\n      this.messageForm.appendChild(this.audioRecorder);\n      this.recorderTimer(document.querySelector('.record-timer'));\n    });\n    recorder.addEventListener('dataavailable', (evt) => {\n      this.chunks.push(evt.data);\n    });\n    recorder.addEventListener('stop', () => {\n      this.audioRecorder.remove();\n    });\n    recorder.start();\n    this.audioRecorder.querySelector('.save-record').addEventListener('click', () => {\n      recorder.stop();\n      let text;\n      setTimeout(() => {\n        this.sourse = URL.createObjectURL(this.chunks[0]);\n        if (videoBul) {\n          text = `<video width = '300' height = '200' controls src = '${this.sourse}'> </video>`;\n        } else {\n          text = `<audio controls src = '${this.sourse}'> </audio>`;\n        }\n        this.createTextMessage(text, this.position.latitude, this.position.longtitude);\n      }, 4000);\n    });\n    this.audioRecorder.querySelector('.cancel-record').addEventListener('click', () => {\n      recorder.stop();\n    });\n  }\n}\n"],"names":["init","this","renderTimeline","timeline","document","createElement","classList","add","container","appendChild","messageForm","innerHTML","askPosition","invalidMessage","innerText","querySelector","noAudio","onclick","style","display","addEventListener","evt","preventDefault","publishTextMessage","createMedia","getPosition","navigator","geolocation","getCurrentPosition","position","latitude","coords","longtitude","longitude","createTextMessage","text","message","Date","toLocaleDateString","toLocaleTimeString","value","setTimeout","getManualPosition","remove","verifyCoords","test","coordinates","replace","split","Number","parseFloat","recorderTimer","element","minutes","seconds","setInterval","async","videoBul","mediaDevices","stream","getUserMedia","audio","video","e","audioRecorder","recorder","MediaRecorder","chunks","push","data","start","stop","sourse","URL","createObjectURL"],"sourceRoot":""}